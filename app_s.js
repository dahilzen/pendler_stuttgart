function draw(){var e=d3.select("body"),t=parseFloat(e.style("width")),n=function(){var e;e=window.innerWidth<[500]?400:600;return e}(),r=d3.geoMercator().scale(function(){var e,t=window.innerWidth;e=t<[500]?6e3:9551;return e}()).center([8.998899309513577,48.675532532333115]).translate([t/2,n/2]),a=d3.scaleThreshold().domain([0,100,500,1e3,2e3,5e3]).range(["#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]),i=d3.geoPath().projection(r).pointRadius(2),o=e.append("svg").attr("width",t).attr("height",n),s=o.append("g").attr("class","features"),l=d3.csv("./pendler_s.csv"),p=d3.csv("./dict_cities.csv"),d=d3.json("./gemeinden.topo.json");Promise.all([l,d,p]).then(function(e){var t=e[1],n=(e[2],topojson.feature(t,t.objects.AX_KommunalesGebiet).features);e[0].forEach(function(e){e.pendler=parseInt(e.pendler)});var r=d3.nest().key(function(e){return e.gkz_arbeit}).entries(e[0]),l={};r.forEach(function(e){l[e.key]=e.values}),s.selectAll("path").data(n).enter().append("path").attr("d",i);var p=o.append("g").attr("class","legend").attr("transform","translate(20,20)");p.append("text").attr("class","caption").attr("x",0).attr("y",-6).style("font-size","120%").text("Einpendler");var d=["0-100","100-500","500-1000","1000-2000","2000-5000","5000+"],c=d3.legendColor().labels(function(e){return d[e.i]}).shapePadding(4).scale(a);o.select(".legend").call(c),function(e){if(l[e.properties.GKZ])var t=l[e.properties.GKZ];else t=[];paint={},pendler_sum=0,t.forEach(function(e){paint[e.gkz_wohn]=e.pendler,pendler_sum+=paint[e.gkz_wohn]}),s.selectAll("path").style("fill",function(t){return e.properties.GKZ===t.properties.GKZ?"tomato":t.properties.GKZ in paint?a(paint[t.properties.GKZ]):void 0}),p.selectAll(".caption").html(function(){return pendler_sum.toLocaleString("de")+" Einpendler nach "+e.properties.NAME})}(n[1102])})}draw();
